{% extends "layout/base.html" %}

{% block content %}
<div class="top-bar">
    <h1>Activities</h1>
    <button onclick="document.getElementById('activityModal').showModal()" class="btn btn-primary">+ New Activity</button>
</div>

<div class="card">
    <div class="timeline">
        {% for activity in activities %}
        <div class="timeline-item">
            <div class="timeline-marker" style="background-color: {% if activity.type == 'call' %}var(--info){% elif activity.type == 'meeting' %}var(--warning){% elif activity.type == 'task' %}var(--success){% else %}var(--primary){% endif %};"></div>
            
            <div style="display: flex; justify-content: space-between; align-items: start;">
                <div>
                    <div style="font-weight: 600;">
                        {{ activity.type|capitalize }}: {{ activity.subject }}
                        {% if activity.completed %}
                        <span class="badge badge-success" style="font-size: 0.7rem; margin-left: 0.5rem;">Completed</span>
                        {% endif %}
                    </div>
                    
                    <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.25rem;">
                        With <a href="/contacts/{{ activity.contact_id }}" style="color: var(--primary);">{{ activity.contact.name }}</a>
                        {% if activity.deal %}
                        â€¢ Deal: {{ activity.deal.title }}
                        {% endif %}
                    </div>
                    
                    <div style="font-size: 0.9rem; margin-top: 0.5rem;">{{ activity.description or '' }}</div>
                    
                    <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.5rem;">
                        {{ activity.date.strftime('%b %d, %Y at %I:%M %p') }}
                    </div>
                </div>
                
                {% if not activity.completed %}
                <form action="/activities/{{ activity.id }}/complete" method="post">
                    <button type="submit" class="btn btn-sm btn-outline">Mark Done</button>
                </form>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- New Activity Modal -->
<dialog id="activityModal" style="border: none; border-radius: 8px; padding: 0; max-width: 500px; width: 100%;">
    <div style="padding: 1.5rem;">
        <h3 style="margin-top: 0;">New Activity</h3>
        <form action="/activities" method="post">
            <div class="form-group">
                <label>Contact</label>
                <select name="contact_id" required>
                    <option value="">Select Contact</option>
                    {% for c in contacts %}
                    <option value="{{ c.id }}">{{ c.name }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group">
                <label>Deal (Optional)</label>
                <select name="deal_id">
                    <option value="">Select Deal</option>
                    {% for d in deals %}
                    <option value="{{ d.id }}">{{ d.title }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group">
                <label>Type</label>
                <select name="type" required>
                    <option value="call">Call</option>
                    <option value="email">Email</option>
                    <option value="meeting">Meeting</option>
                    <option value="note">Note</option>
                    <option value="task">Task</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Subject</label>
                <input type="text" name="subject" required>
            </div>
            
            <div class="form-group">
                <label>Date</label>
                <input type="datetime-local" name="date_str" required>
            </div>
            
            <div class="form-group">
                <label>Description</label>
                <textarea name="description" style="min-height: 100px;"></textarea>
            </div>
            
            <div style="display: flex; justify-content: flex-end; gap: 0.5rem;">
                <button type="button" onclick="document.getElementById('activityModal').close()" class="btn btn-outline">Cancel</button>
                <button type="submit" class="btn btn-primary">Save</button>
            </div>
        </form>
    </div>
</dialog>
{% endblock %}
