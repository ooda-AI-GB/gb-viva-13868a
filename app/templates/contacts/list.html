{% extends "layout/base.html" %}

{% block content %}
<div class="top-bar">
    <h1>Contacts</h1>
    <a href="/contacts/new" class="btn btn-primary">+ New Contact</a>
</div>

<div class="card">
    <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
        <input type="text" placeholder="Search contacts..." id="searchInput">
        <select id="statusFilter">
            <option value="">All Statuses</option>
            <option value="lead">Lead</option>
            <option value="contacted">Contacted</option>
            <option value="proposal">Proposal</option>
            <option value="negotiation">Negotiation</option>
            <option value="closed_won">Closed Won</option>
            <option value="closed_lost">Closed Lost</option>
        </select>
    </div>

    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Company</th>
                <th>Status</th>
                <th>Created</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {% for contact in contacts %}
            <tr>
                <td><a href="/contacts/{{ contact.id }}" style="color: var(--primary); font-weight: 500; text-decoration: none;">{{ contact.name }}</a></td>
                <td>{{ contact.email }}</td>
                <td>{{ contact.company or '' }}</td>
                <td><span class="badge badge-{{ contact.status }}">{{ contact.status.replace('_', ' ') }}</span></td>
                <td>{{ contact.created_at.strftime('%Y-%m-%d') }}</td>
                <td style="text-align: right;">
                    <a href="/contacts/{{ contact.id }}/edit" class="btn btn-sm btn-outline">Edit</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
    const searchInput = document.getElementById('searchInput');
    const statusFilter = document.getElementById('statusFilter');
    const tableRows = document.querySelectorAll('tbody tr');

    function filterContacts() {
        const searchTerm = searchInput.value.toLowerCase();
        const status = statusFilter.value.toLowerCase();

        tableRows.forEach(row => {
            const text = row.textContent.toLowerCase();
            const rowStatus = row.querySelector('.badge').className.toLowerCase(); // Check class name for status
            
            const matchesSearch = text.includes(searchTerm);
            const matchesStatus = status === '' || rowStatus.includes(status);

            row.style.display = matchesSearch && matchesStatus ? '' : 'none';
        });
    }

    searchInput.addEventListener('input', filterContacts);
    statusFilter.addEventListener('change', filterContacts);
</script>
{% endblock %}
