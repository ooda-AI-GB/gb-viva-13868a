{% extends "layout/base.html" %}

{% block content %}
<div class="top-bar">
    <h1>Dashboard</h1>
</div>

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-value">{{ total_contacts }}</div>
        <div class="stat-label">Total Contacts</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ open_deals_count }}</div>
        <div class="stat-label">Open Deals</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">${{ "{:,.0f}".format(total_pipeline_value) }}</div>
        <div class="stat-label">Pipeline Value</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ win_rate }}%</div>
        <div class="stat-label">Win Rate</div>
    </div>
</div>

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
    <!-- Pipeline Summary -->
    <div class="card">
        <h2>Pipeline Summary</h2>
        <table style="width: 100%; margin-top: 1rem;">
            <thead>
                <tr>
                    <th>Stage</th>
                    <th>Count</th>
                    <th style="text-align: right;">Value</th>
                </tr>
            </thead>
            <tbody>
                {% for stage, data in pipeline_summary.items() %}
                <tr>
                    <td><span class="badge badge-{{ stage }}">{{ stage.replace('_', ' ') }}</span></td>
                    <td>{{ data.count }}</td>
                    <td style="text-align: right;">${{ "{:,.0f}".format(data.value) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Upcoming Tasks -->
    <div class="card">
        <h2>Upcoming Tasks</h2>
        <div style="margin-top: 1rem;">
            {% if upcoming_tasks %}
                {% for task in upcoming_tasks %}
                <div style="border-bottom: 1px solid var(--border); padding: 0.75rem 0; display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <div style="font-weight: 600;">{{ task.subject }}</div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary);">
                            Due: {{ task.date.strftime('%b %d, %I:%M %p') }}
                        </div>
                    </div>
                    <form action="/activities/{{ task.id }}/complete" method="post" style="margin: 0;">
                        <button type="submit" class="btn btn-sm btn-outline">Done</button>
                    </form>
                </div>
                {% endfor %}
            {% else %}
                <div style="color: var(--text-secondary); text-align: center; padding: 1rem;">No upcoming tasks</div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Recent Activities -->
<div class="card" style="margin-top: 2rem;">
    <h2>Recent Activities</h2>
    <div class="timeline" style="margin-top: 1.5rem;">
        {% for activity in recent_activities %}
        <div class="timeline-item">
            <div class="timeline-marker"></div>
            <div style="font-weight: 600;">{{ activity.type|capitalize }}: {{ activity.subject }}</div>
            <div style="font-size: 0.9rem; margin-top: 0.25rem;">{{ activity.description or '' }}</div>
            <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.25rem;">
                {{ activity.created_at.strftime('%b %d, %Y at %I:%M %p') }}
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
